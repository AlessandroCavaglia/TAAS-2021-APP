{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport PanResponder from \"react-native-web/dist/exports/PanResponder\";\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport TinderCard from \"./TinderCard\";\nimport Constants from \"../constants\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar SCREEN_HEIGHT = Dimensions.get('window').height;\nvar SCREEN_WIDTH = Dimensions.get('window').width;\nvar SHOWABLE_CARDS = 3;\nvar styles = StyleSheet.create({\n  animatedView: {\n    height: SCREEN_HEIGHT - 200,\n    width: SCREEN_WIDTH - 120,\n    padding: 10,\n    backgroundColor: '#fa0000',\n    position: 'absolute'\n  },\n  cardView: {\n    height: \"100%\",\n    width: \"100%\",\n    position: 'absolute'\n  },\n  viewContainer: {\n    flex: 1,\n    paddingLeft: \"7%\",\n    paddingRight: \"7%\"\n  },\n  topText: {\n    paddingTop: \"8%\",\n    paddingBottom: \"3%\",\n    fontSize: 30,\n    fontWeight: \"bold\"\n  },\n  cardContainer: {\n    flex: 1,\n    height: \"60%\",\n    maxHeight: \"60%\"\n  }\n});\nvar Cards = [{\n  id: \"1\",\n  title: 'Xbox',\n  description: 'Descrizione',\n  categories: 'category1,category2',\n  priceRange: 1,\n  images: []\n}, {\n  id: \"2\",\n  title: 'Xbox1',\n  description: 'Descrizione',\n  categories: 'category1,category2',\n  priceRange: 1,\n  images: []\n}, {\n  id: \"3\",\n  title: 'Xbox2',\n  description: 'Descrizione',\n  categories: 'category1,category2',\n  priceRange: 1,\n  images: []\n}, {\n  id: \"4\",\n  title: 'Xbox3',\n  description: 'Descrizione',\n  categories: 'category1,category2',\n  priceRange: 1,\n  images: []\n}];\n\nvar ProductTab = function (_React$Component) {\n  _inherits(ProductTab, _React$Component);\n\n  var _super = _createSuper(ProductTab);\n\n  function ProductTab(props) {\n    var _this;\n\n    _classCallCheck(this, ProductTab);\n\n    _this = _super.call(this, props);\n\n    _this.renderCards = function () {\n      return _this.state.products.map(function (item, i) {\n        if (i < _this.state.currentIndex) {\n          return null;\n        } else if (Math.abs(_this.state.currentIndex - i) < SHOWABLE_CARDS) return _jsx(Animated.View, _objectSpread(_objectSpread({\n            style: i === _this.state.currentIndex ? [styles.cardView, _this.rotateAndTranslate] : [styles.cardView, {\n              marginTop: _this.nextCardPosition\n            }]\n          }, _this.PanResponder.panHandlers), {}, {\n            children: _jsx(TinderCard, {\n              elem: item,\n              actualIndex: _this.state.currentIndex\n            })\n          }), i);else if (Math.abs(_this.state.currentIndex - i) === SHOWABLE_CARDS) return _jsx(Animated.View, _objectSpread(_objectSpread({\n            style: i === _this.state.currentIndex ? [styles.cardView, _this.rotateAndTranslate] : [styles.cardView, {\n              marginTop: _this.nextCardPosition,\n              opacity: _this.nextCardOpacity\n            }]\n          }, _this.PanResponder.panHandlers), {}, {\n            children: _jsx(TinderCard, {\n              elem: item,\n              actualIndex: _this.state.currentIndex\n            })\n          }), i);\n      }).reverse();\n    };\n\n    _this.state = {\n      user: null,\n      products: [],\n      currentIndex: 0\n    };\n\n    _this.loadUser().then(function () {\n      _this.loadProducts();\n    });\n\n    _this.props.navigation.addListener('focus', function () {\n      _this.loadUser().then(function () {\n        _this.loadProducts();\n      });\n    });\n\n    _this.position = new Animated.ValueXY();\n    _this.rotate = _this.position.x.interpolate({\n      inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\n      outputRange: ['-10deg', '0deg', '10deg'],\n      extrapolate: 'clamp'\n    });\n    _this.rotateAndTranslate = {\n      transform: [{\n        rotate: _this.rotate\n      }].concat(_toConsumableArray(_this.position.getTranslateTransform()))\n    };\n    _this.nextCardPosition = _this.position.x.interpolate({\n      inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\n      outputRange: [-15, 0, -15],\n      extrapolate: 'clamp'\n    });\n    _this.nextCardOpacity = _this.position.x.interpolate({\n      inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\n      outputRange: [1, 0, 1],\n      extrapolate: 'clamp'\n    });\n    _this.PanResponder = PanResponder.create({\n      onStartShouldSetPanResponder: function onStartShouldSetPanResponder(evt, gestureState) {\n        return true;\n      },\n      onPanResponderMove: function onPanResponderMove(evt, gestureState) {\n        _this.position.setValue({\n          x: gestureState.dx,\n          y: gestureState.dy\n        });\n      },\n      onPanResponderRelease: function onPanResponderRelease(evt, gestureState) {\n        if (gestureState.dx > 120) {\n          console.log(\"Swipe a Destra\");\n          Animated.spring(_this.position, {\n            toValue: {\n              x: SCREEN_WIDTH + 100,\n              y: gestureState.dy\n            },\n            useNativeDriver: false\n          }).start(function () {\n            _this.setState({\n              currentIndex: _this.state.currentIndex + 1\n            }, function () {\n              _this.position.setValue({\n                x: 0,\n                y: 0\n              });\n            });\n          });\n        } else if (gestureState.dx < -120) {\n          console.log(\"Swipe a Sinistra\");\n          Animated.spring(_this.position, {\n            toValue: {\n              x: -SCREEN_WIDTH - 100,\n              y: gestureState.dy\n            },\n            useNativeDriver: false\n          }).start(function () {\n            _this.setState({\n              currentIndex: _this.state.currentIndex + 1\n            }, function () {\n              _this.position.setValue({\n                x: 0,\n                y: 0\n              });\n            });\n          });\n        } else {\n          Animated.spring(_this.position, {\n            toValue: {\n              x: 0,\n              y: 0\n            },\n            friction: 4,\n            useNativeDriver: false\n          }).start();\n        }\n      }\n    });\n    return _this;\n  }\n\n  _createClass(ProductTab, [{\n    key: \"loadUser\",\n    value: function loadUser() {\n      var value;\n      return _regeneratorRuntime.async(function loadUser$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"user\"));\n\n            case 2:\n              value = _context.sent;\n              if (value != null) this.setState({\n                user: JSON.parse(value)\n              });\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"removeUser\",\n    value: function removeUser() {\n      return _regeneratorRuntime.async(function removeUser$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"user\"));\n\n            case 2:\n              this.setState({\n                user: null\n              });\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"loadProducts\",\n    value: function loadProducts() {\n      var _this2 = this;\n\n      var body, requestOptions, response;\n      return _regeneratorRuntime.async(function loadProducts$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(this.state.user !== null)) {\n                _context3.next = 7;\n                break;\n              }\n\n              body = {\n                latitudePoint: 44.8980033,\n                longitudePoint: 8.2064966,\n                radius: 500,\n                categoryNumber: \"1\",\n                category1: \"%\",\n                category2: \"\",\n                category3: \"\"\n              };\n              requestOptions = {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Access-Control-Allow-Origin': '*',\n                  'access-token': this.state.user.tokenObject.token\n                },\n                body: JSON.stringify(body)\n              };\n              _context3.next = 5;\n              return _regeneratorRuntime.awrap(fetch(Constants.serverIp + Constants.productMicroserviceName + \"products/filter\", requestOptions));\n\n            case 5:\n              response = _context3.sent;\n\n              if (response.ok) {\n                response.json().then(function (obj) {\n                  obj.forEach(function (elem) {\n                    elem.selected_img = 0;\n                    elem.images = [];\n\n                    if (elem.image1 != null) {\n                      elem.images.push(\"data:image/png;base64,\" + elem.image1.toString());\n                    }\n\n                    if (elem.image2 != null) {\n                      elem.images.push(\"data:image/png;base64,\" + elem.image2.toString());\n                    }\n\n                    if (elem.image3 != null) {\n                      elem.images.push(\"data:image/png;base64,\" + elem.image3.toString());\n                    }\n\n                    console.log(elem.images);\n                  });\n\n                  _this2.setState({\n                    products: obj\n                  });\n\n                  _this2.setState({\n                    currentIndex: 0\n                  });\n                });\n              } else {\n                if (response.status === 401) {\n                  this.removeUser();\n                }\n              }\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _jsxs(View, {\n        style: styles.viewContainer,\n        children: [_jsx(Text, {\n          style: styles.topText,\n          children: \"Scopri\"\n        }), _jsx(View, {\n          style: {\n            height: \"10%\"\n          }\n        }), _jsx(View, {\n          style: styles.cardContainer,\n          children: this.renderCards()\n        })]\n      });\n    }\n  }]);\n\n  return ProductTab;\n}(React.Component);\n\nexport { ProductTab as default };","map":{"version":3,"sources":["D:/UniversityProjects/Taas/Front-End TAAS/Taas-App/components/productTab/ProductTab.js"],"names":["React","useEffect","AsyncStorage","TinderCard","Constants","SCREEN_HEIGHT","Dimensions","get","height","SCREEN_WIDTH","width","SHOWABLE_CARDS","styles","StyleSheet","create","animatedView","padding","backgroundColor","position","cardView","viewContainer","flex","paddingLeft","paddingRight","topText","paddingTop","paddingBottom","fontSize","fontWeight","cardContainer","maxHeight","Cards","id","title","description","categories","priceRange","images","ProductTab","props","renderCards","state","products","map","item","i","currentIndex","Math","abs","rotateAndTranslate","marginTop","nextCardPosition","PanResponder","panHandlers","opacity","nextCardOpacity","reverse","user","loadUser","then","loadProducts","navigation","addListener","Animated","ValueXY","rotate","x","interpolate","inputRange","outputRange","extrapolate","transform","getTranslateTransform","onStartShouldSetPanResponder","evt","gestureState","onPanResponderMove","setValue","dx","y","dy","onPanResponderRelease","console","log","spring","toValue","useNativeDriver","start","setState","friction","getItem","value","JSON","parse","removeItem","body","latitudePoint","longitudePoint","radius","categoryNumber","category1","category2","category3","requestOptions","method","headers","tokenObject","token","stringify","fetch","serverIp","productMicroserviceName","response","ok","json","obj","forEach","elem","selected_img","image1","push","toString","image2","image3","status","removeUser","Component"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react';\r\nimport {StyleSheet, Text, View, Button, Animated, Dimensions, PanResponder, AsyncStorage} from 'react-native';\r\nimport TinderCard from \"./TinderCard\";\r\nimport Constants from \"../constants\";\r\n\r\nconst SCREEN_HEIGHT = Dimensions.get('window').height\r\nconst SCREEN_WIDTH = Dimensions.get('window').width\r\nconst SHOWABLE_CARDS = 3\r\nconst styles = StyleSheet.create({\r\n    animatedView:{\r\n        height: SCREEN_HEIGHT -200,\r\n        width: SCREEN_WIDTH-120,\r\n        padding: 10,\r\n        backgroundColor:'#fa0000',\r\n        position:'absolute',\r\n    },\r\n    cardView:{\r\n        height: \"100%\",\r\n        width: \"100%\",\r\n        position:'absolute'\r\n    },\r\n    viewContainer:{\r\n        flex:1,\r\n        paddingLeft:\"7%\",\r\n        paddingRight:\"7%\",\r\n    },\r\n    topText:{\r\n        paddingTop:\"8%\",\r\n        paddingBottom:\"3%\",\r\n        fontSize:30,\r\n        fontWeight:\"bold\",\r\n    },\r\n    cardContainer:{\r\n        flex:1,\r\n        height: \"60%\",\r\n        maxHeight:\"60%\"\r\n    }\r\n})\r\nconst Cards = [\r\n    { id: \"1\",title: 'Xbox',description:'Descrizione',categories:'category1,category2',priceRange:1,images:[] },\r\n    { id: \"2\",title: 'Xbox1',description:'Descrizione',categories:'category1,category2',priceRange:1,images:[] },\r\n    { id: \"3\",title: 'Xbox2',description:'Descrizione',categories:'category1,category2',priceRange:1,images:[] },\r\n    { id: \"4\",title: 'Xbox3',description:'Descrizione',categories:'category1,category2',priceRange:1,images:[] },\r\n]\r\n\r\nexport default class ProductTab extends React.Component {\r\n\r\n    async loadUser(){\r\n        const value = await AsyncStorage.getItem(\"user\");\r\n        if(value!=null)\r\n            this.setState({user:JSON.parse(value)})\r\n    }\r\n\r\n    async removeUser(){\r\n        await  AsyncStorage.removeItem(\"user\");\r\n        this.setState({user:null});\r\n    }\r\n\r\n    async loadProducts() {\r\n        if (this.state.user !== null) {\r\n            const body = {\r\n                latitudePoint: 44.8980033,\r\n                longitudePoint: 8.2064966,\r\n                radius: 500,\r\n                categoryNumber: \"1\",\r\n                category1: \"%\",\r\n                category2: \"\",\r\n                category3: \"\"\r\n            }\r\n            const requestOptions = {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Access-Control-Allow-Origin': '*',\r\n                    'access-token': this.state.user.tokenObject.token\r\n                },\r\n                body: JSON.stringify(body)\r\n            };\r\n            const response = await fetch(Constants.serverIp + Constants.productMicroserviceName + \"products/filter\", requestOptions)\r\n                if (response.ok) {\r\n                    response.json().then((obj) => {\r\n                        obj.forEach((elem) => {\r\n                            elem.selected_img = 0\r\n                            elem.images = []\r\n                            if (elem.image1 != null) {\r\n                                elem.images.push(\"data:image/png;base64,\"+elem.image1.toString())\r\n                            }\r\n                            if (elem.image2 != null) {\r\n                                elem.images.push(\"data:image/png;base64,\"+elem.image2.toString())\r\n                            }\r\n                            if (elem.image3 != null) {\r\n                                elem.images.push(\"data:image/png;base64,\"+elem.image3.toString())\r\n                            }\r\n                            console.log(elem.images);\r\n                        })\r\n                        this.setState({products: obj})\r\n                        this.setState({currentIndex: 0})\r\n                    })\r\n                } else {\r\n                    if (response.status === 401) {\r\n                        this.removeUser();\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={user:null,products:[],currentIndex:0}\r\n        this.loadUser().then(()=>{this.loadProducts()});\r\n        this.props.navigation.addListener('focus',()=>{\r\n            this.loadUser().then(()=>{this.loadProducts()});\r\n        });\r\n        this.position = new Animated.ValueXY();\r\n        this.rotate = this.position.x.interpolate({\r\n            inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\r\n            outputRange: ['-10deg', '0deg', '10deg'],\r\n            extrapolate: 'clamp'\r\n        })\r\n        this.rotateAndTranslate = {\r\n            transform: [{\r\n                rotate: this.rotate\r\n            },\r\n                ...this.position.getTranslateTransform()\r\n            ]\r\n        }\r\n        this.nextCardPosition = this.position.x.interpolate({\r\n            inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\r\n            outputRange: [-15, 0, -15],\r\n            extrapolate: 'clamp'\r\n        })\r\n        this.nextCardOpacity = this.position.x.interpolate({\r\n            inputRange: [-SCREEN_WIDTH / 2, 0, SCREEN_WIDTH / 2],\r\n            outputRange: [1, 0, 1],\r\n            extrapolate: 'clamp'\r\n        })\r\n        this.PanResponder = PanResponder.create({\r\n            onStartShouldSetPanResponder: (evt, gestureState) => true,\r\n            onPanResponderMove: (evt, gestureState) => {\r\n                this.position.setValue({ x: gestureState.dx, y: gestureState.dy });\r\n            },\r\n            onPanResponderRelease: (evt, gestureState) => {\r\n                if (gestureState.dx > 120) {\r\n                    //Swipe A Destra\r\n                    console.log(\"Swipe a Destra\")\r\n                    Animated.spring(this.position, {\r\n                        toValue: { x: SCREEN_WIDTH + 100, y: gestureState.dy },\r\n                        useNativeDriver: false\r\n                    }).start(() => {\r\n                        this.setState({ currentIndex: this.state.currentIndex + 1 }, () => {\r\n                            this.position.setValue({ x: 0, y: 0 })\r\n                        })\r\n                    })\r\n                } else if (gestureState.dx < -120) {\r\n                    //Swipe A Sinistra\r\n                    console.log(\"Swipe a Sinistra\")\r\n                    Animated.spring(this.position, {\r\n                        toValue: { x: -SCREEN_WIDTH - 100, y: gestureState.dy },\r\n                        useNativeDriver: false\r\n                    }).start(() => {\r\n                        this.setState({ currentIndex: this.state.currentIndex + 1 }, () => {\r\n                            this.position.setValue({ x: 0, y: 0 })\r\n                        })\r\n                    })\r\n                }else {\r\n                    Animated.spring(this.position, {\r\n                        toValue: { x: 0, y: 0 },\r\n                        friction: 4,\r\n                        useNativeDriver: false\r\n                    }).start()\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    renderCards = () =>{\r\n        return this.state.products.map((item,i) => {\r\n            if (i < this.state.currentIndex) {\r\n                return null;\r\n            } else if (Math.abs(this.state.currentIndex -i) < SHOWABLE_CARDS) //Se è una card nel range di quelle da visualizzare\r\n                return<Animated.View key={i} style={ i===this.state.currentIndex ?      //La stampiamo visibile e traslata un pelo verso il basso\r\n                                                [styles.cardView, this.rotateAndTranslate] :\r\n                                                [styles.cardView,{marginTop:this.nextCardPosition}]}/*opacity: this.nextCardOpacity,*/ /*,*/\r\n                                                {...this.PanResponder.panHandlers}>\r\n                        <TinderCard elem={item} actualIndex={this.state.currentIndex}/>\r\n                    </Animated.View>\r\n            else if (Math.abs(this.state.currentIndex -i) === SHOWABLE_CARDS)   //Se è la prima card che non visualizziamo\r\n                return <Animated.View key={i} style={ i===this.state.currentIndex ?         //La stampiamo con animazione\r\n                    [styles.cardView, this.rotateAndTranslate] :\r\n                    [styles.cardView,{marginTop:this.nextCardPosition,opacity: this.nextCardOpacity}]}\r\n                                      {...this.PanResponder.panHandlers}>\r\n                    <TinderCard elem={item} actualIndex={this.state.currentIndex}/>\r\n                </Animated.View>\r\n        }).reverse()\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <View style={styles.viewContainer}>\r\n                <Text style={styles.topText}>Scopri</Text>\r\n                <View style={{ height:\"10%\" }}>{/* Filter bar */}</View>\r\n                <View style={styles.cardContainer}>\r\n                    {this.renderCards()}\r\n                </View>\r\n            </View>\r\n        );\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}