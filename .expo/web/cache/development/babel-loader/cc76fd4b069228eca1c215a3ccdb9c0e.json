{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { useEffect } from 'react';\nimport Icon from \"@expo/vector-icons/FontAwesome\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport generalStyleSheet from \"../general/GeneralStyleSheet\";\nimport Constants from \"../constants\";\nimport * as Facebook from 'expo-facebook';\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar ProfileTab = function (_React$Component) {\n  _inherits(ProfileTab, _React$Component);\n\n  var _super = _createSuper(ProfileTab);\n\n  function ProfileTab(props) {\n    var _this;\n\n    _classCallCheck(this, ProfileTab);\n\n    _this = _super.call(this, props);\n    _this.token = null;\n    _this.state = {\n      user: null,\n      loginPhase: 0,\n      username: \"\"\n    };\n\n    _this.props.navigation.addListener('focus', function () {\n      _this.loadUser();\n    });\n\n    return _this;\n  }\n\n  _createClass(ProfileTab, [{\n    key: \"storeUser\",\n    value: function storeUser(userObject, tokenObject) {\n      return _regeneratorRuntime.async(function storeUser$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"user\", JSON.stringify({\n                userObject: userObject,\n                tokenObject: tokenObject\n              })));\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, {\n    key: \"loadUser\",\n    value: function loadUser() {\n      var value;\n      return _regeneratorRuntime.async(function loadUser$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"user\"));\n\n            case 2:\n              value = _context2.sent;\n              if (value != null) this.setState({\n                user: JSON.parse(value)\n              });else this.setState({\n                user: null\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"removeUser\",\n    value: function removeUser() {\n      return _regeneratorRuntime.async(function removeUser$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"user\"));\n\n            case 2:\n              this.setState({\n                user: null\n              });\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"facebookLogin\",\n    value: function facebookLogin() {\n      var _this2 = this;\n\n      var _await$Facebook$logIn, type, token, body, requestOptions, response, message;\n\n      return _regeneratorRuntime.async(function facebookLogin$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return _regeneratorRuntime.awrap(Facebook.initializeAsync({\n                appId: '451106016421871'\n              }));\n\n            case 3:\n              _context4.next = 5;\n              return _regeneratorRuntime.awrap(Facebook.logInWithReadPermissionsAsync({\n                permissions: [\"public_profile\"]\n              }));\n\n            case 5:\n              _await$Facebook$logIn = _context4.sent;\n              type = _await$Facebook$logIn.type;\n              token = _await$Facebook$logIn.token;\n\n              if (!(type === 'success')) {\n                _context4.next = 16;\n                break;\n              }\n\n              this.token = token;\n              body = {\n                token: token,\n                username: \"\"\n              };\n              requestOptions = {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Access-Control-Allow-Origin': '*'\n                },\n                body: JSON.stringify(body)\n              };\n              _context4.next = 14;\n              return _regeneratorRuntime.awrap(fetch(Constants.serverIp + Constants.userMicroserviceName + \"user\", requestOptions));\n\n            case 14:\n              response = _context4.sent;\n\n              if (response.ok) {\n                response.text().then(function (text) {\n                  var fields = text.split(\"AccessToken\");\n                  var userObjectString = fields[0].substr(6);\n                  var userObject = JSON.parse(userObjectString);\n                  var tokenObject = JSON.parse(fields[1]);\n\n                  _this2.setState({\n                    user: {\n                      userObject: userObject,\n                      tokenObject: tokenObject\n                    }\n                  });\n\n                  _this2.storeUser(userObject, tokenObject);\n                });\n              } else {\n                this.setState({\n                  loginPhase: 1\n                });\n                console.log(\"nessun utente trovato\", response);\n              }\n\n            case 16:\n              _context4.next = 22;\n              break;\n\n            case 18:\n              _context4.prev = 18;\n              _context4.t0 = _context4[\"catch\"](0);\n              message = _context4.t0.message;\n              console.log(\"Facebook Login Error \" + message);\n\n            case 22:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, this, [[0, 18]], Promise);\n    }\n  }, {\n    key: \"completeLogin\",\n    value: function completeLogin() {\n      var _this3 = this;\n\n      var username, body, requestOptions, response;\n      return _regeneratorRuntime.async(function completeLogin$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              username = this.state.username;\n\n              if (!(new RegExp('^[a-zA-Z0-9._-]{3,}$').test(username) && username !== undefined && username !== null)) {\n                _context5.next = 10;\n                break;\n              }\n\n              body = {\n                token: this.token,\n                username: username\n              };\n              requestOptions = {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Access-Control-Allow-Origin': '*'\n                },\n                body: JSON.stringify(body)\n              };\n              _context5.next = 6;\n              return _regeneratorRuntime.awrap(fetch(Constants.serverIp + Constants.userMicroserviceName + \"loginFB\", requestOptions));\n\n            case 6:\n              response = _context5.sent;\n\n              if (response.ok) {\n                response.text().then(function (text) {\n                  var fields = text.split(\"AccessToken\");\n                  var userObjectString = fields[0].substr(6);\n                  var userObject = JSON.parse(userObjectString);\n                  var tokenObject = JSON.parse(fields[1]);\n\n                  _this3.setState({\n                    user: {\n                      userObject: userObject,\n                      tokenObject: tokenObject\n                    }\n                  });\n\n                  _this3.storeUser(userObject, tokenObject);\n                });\n              } else {\n                this.setState({\n                  loginPhase: 0\n                });\n              }\n\n              _context5.next = 11;\n              break;\n\n            case 10:\n              this.setState({\n                loginPhase: 0\n              });\n\n            case 11:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return _jsxs(View, {\n        style: generalStyleSheet.viewContainer,\n        children: [_jsx(Text, {\n          style: generalStyleSheet.bigTitle,\n          children: \"Profilo\"\n        }), _jsx(View, {\n          style: [style.profileContainer, generalStyleSheet.bigBorder],\n          children: _jsxs(View, {\n            style: style.leftColumn,\n            children: [_jsxs(View, {\n              style: style.firstProfileRow,\n              children: [_jsx(Icon, {\n                name: \"user-circle\",\n                size: 100\n              }), _jsx(Text, {\n                style: [style.usernameText, generalStyleSheet.mediumTitle],\n                children: this.state.user != null ? this.state.user.userObject.username : \"Username\"\n              })]\n            }), _jsxs(View, {\n              style: style.profileRow,\n              children: [_jsxs(Text, {\n                style: [generalStyleSheet.normalText, style.profileText],\n                children: [\"Nome: \", this.state.user != null ? this.state.user.userObject.firstName : \"FirstName\"]\n              }), _jsxs(Text, {\n                style: [generalStyleSheet.normalText, style.profileText],\n                children: [\"Cognome: \", this.state.user != null ? this.state.user.userObject.lastName : \"LastName\"]\n              }), _jsxs(Text, {\n                style: [generalStyleSheet.normalText, style.profileText],\n                children: [\"DataNascita: \", this.state.user != null ? this.state.user.userObject.birthday : \"Birthday\"]\n              }), _jsxs(Text, {\n                style: [generalStyleSheet.normalText, style.profileText],\n                children: [\"Email: \", this.state.user != null ? this.state.user.userObject.email : \"Email\"]\n              }), _jsx(Button, {\n                onPress: function onPress() {\n                  return _this4.removeUser();\n                },\n                style: style.logOut,\n                title: \"LogOut\"\n              })]\n            })]\n          })\n        }), this.renderBlockingView()]\n      });\n    }\n  }, {\n    key: \"renderBlockingView\",\n    value: function renderBlockingView() {\n      var _this5 = this;\n\n      if (this.state.user == null) {\n        if (this.state.loginPhase === 0) {\n          return _jsx(View, {\n            style: [style.notLoggedTab, generalStyleSheet.bigBorder],\n            children: _jsxs(View, {\n              children: [_jsx(Text, {\n                style: generalStyleSheet.bigTitle,\n                children: \"Sembrerebbe che tu non sia loggato\"\n              }), _jsx(Button, {\n                title: \"Login con Facebook\",\n                onPress: function onPress() {\n                  return _this5.facebookLogin();\n                }\n              })]\n            })\n          });\n        } else {\n          return _jsx(View, {\n            style: [style.notLoggedTab, generalStyleSheet.bigBorder],\n            children: _jsxs(View, {\n              children: [_jsx(Text, {\n                style: generalStyleSheet.bigTitle,\n                children: \"Inserisci il tuo username\"\n              }), _jsx(TextInput, {\n                style: style.textInput,\n                onChange: function onChange(text) {\n                  return _this5.setState({\n                    username: text\n                  });\n                }\n              }), _jsx(Button, {\n                title: \"Completa login\",\n                onPress: function onPress() {\n                  return _this5.completeLogin();\n                }\n              })]\n            })\n          });\n        }\n      }\n    }\n  }]);\n\n  return ProfileTab;\n}(React.Component);\n\nexport { ProfileTab as default };\nvar style = StyleSheet.create({\n  profileContainer: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    width: \"100%\",\n    marginTop: \"3%\",\n    height: \"75%\"\n  },\n  notLoggedTab: {\n    width: \"100%\",\n    marginTop: \"-1%\",\n    height: \"115%\",\n    position: \"absolute\",\n    backgroundColor: \"white\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: \"2%\"\n  },\n  textInput: {\n    borderRadius: 5,\n    borderWidth: 1,\n    borderColor: \"black\",\n    marginTop: \"4%\",\n    marginBottom: \"4%\"\n  },\n  leftColumn: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"100%\"\n  },\n  rightColumn: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"75%\"\n  },\n  firstProfileRow: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    width: \"100%\",\n    paddingLeft: \"10%\",\n    paddingTop: \"10%\",\n    borderBottomWidth: 1\n  },\n  profileRow: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"100%\"\n  },\n  usernameText: {\n    paddingLeft: \"12%\",\n    height: \"100%\",\n    lineHeight: 100,\n    paddingTop: \"4%\",\n    textAlign: \"center\"\n  },\n  profileText: {\n    paddingLeft: \"10%\",\n    paddingBottom: \"5%\",\n    paddingTop: \"5%\",\n    borderBottomWidth: 1,\n    fontSize: 15\n  },\n  productTitle: {\n    textAlign: \"center\",\n    marginTop: \"6%\",\n    flex: 0.1\n  },\n  productsView: {\n    display: \"flex\",\n    flex: 0.9,\n    width: \"100%\",\n    marginTop: \"2%\"\n  },\n  logOut: {\n    backgroundColor: \"white\",\n    color: \"black\",\n    borderWidth: 2,\n    borderColor: \"black\",\n    borderRadius: 5\n  }\n});","map":{"version":3,"sources":["D:/UniversityProjects/Taas/Front-End TAAS/Taas-App/components/profileTab/ProfileTab.js"],"names":["React","useEffect","Icon","generalStyleSheet","Constants","Facebook","AsyncStorage","ProfileTab","props","token","state","user","loginPhase","username","navigation","addListener","loadUser","userObject","tokenObject","setItem","JSON","stringify","getItem","value","setState","parse","removeItem","initializeAsync","appId","logInWithReadPermissionsAsync","permissions","type","body","requestOptions","method","headers","fetch","serverIp","userMicroserviceName","response","ok","text","then","fields","split","userObjectString","substr","storeUser","console","log","message","RegExp","test","undefined","viewContainer","bigTitle","style","profileContainer","bigBorder","leftColumn","firstProfileRow","usernameText","mediumTitle","profileRow","normalText","profileText","firstName","lastName","birthday","email","removeUser","logOut","renderBlockingView","notLoggedTab","facebookLogin","textInput","completeLogin","Component","StyleSheet","create","display","flexDirection","width","marginTop","height","position","backgroundColor","alignItems","justifyContent","padding","borderRadius","borderWidth","borderColor","marginBottom","rightColumn","paddingLeft","paddingTop","borderBottomWidth","lineHeight","textAlign","paddingBottom","fontSize","productTitle","flex","productsView","color"],"mappings":";;;;;;;;;;;AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,OAAOC,IAAP;;;;;;;AAEA,OAAOC,iBAAP;AACA,OAAOC,SAAP;AACA,OAAO,KAAKC,QAAZ,MAA0B,eAA1B;SACSC,Y;;;;IAGYC,U;;;;;AAEjB,sBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,8BAAMA,KAAN;AADe,UAQnBC,KARmB,GAQb,IARa;AAEf,UAAKC,KAAL,GAAW;AAACC,MAAAA,IAAI,EAAC,IAAN;AAAWC,MAAAA,UAAU,EAAC,CAAtB;AAAwBC,MAAAA,QAAQ,EAAC;AAAjC,KAAX;;AACA,UAAKL,KAAL,CAAWM,UAAX,CAAsBC,WAAtB,CAAkC,OAAlC,EAA0C,YAAI;AAC1C,YAAKC,QAAL;AACH,KAFD;;AAHe;AAMlB;;;;WAID,mBAAgBC,UAAhB,EAA2BC,WAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACUZ,YAAY,CAACa,OAAb,CAAqB,MAArB,EAA4BC,IAAI,CAACC,SAAL,CAAe;AAACJ,gBAAAA,UAAU,EAACA,UAAZ;AAAuBC,gBAAAA,WAAW,EAACA;AAAnC,eAAf,CAA5B,CADV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACwBZ,YAAY,CAACgB,OAAb,CAAqB,MAArB,CADxB;;AAAA;AACUC,cAAAA,KADV;AAEI,kBAAGA,KAAK,IAAE,IAAV,EACI,KAAKC,QAAL,CAAc;AAACb,gBAAAA,IAAI,EAACS,IAAI,CAACK,KAAL,CAAWF,KAAX;AAAN,eAAd,EADJ,KAGI,KAAKC,QAAL,CAAc;AAACb,gBAAAA,IAAI,EAAC;AAAN,eAAd;;AALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACWL,YAAY,CAACoB,UAAb,CAAwB,MAAxB,CADX;;AAAA;AAEI,mBAAKF,QAAL,CAAc;AAACb,gBAAAA,IAAI,EAAC;AAAN,eAAd;;AAFJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WAKA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CAEcN,QAAQ,CAACsB,eAAT,CAAyB;AAC3BC,gBAAAA,KAAK,EAAE;AADoB,eAAzB,CAFd;;AAAA;AAAA;AAAA,+CAKoCvB,QAAQ,CAACwB,6BAAT,CACxB;AACIC,gBAAAA,WAAW,EAAE,CAAC,gBAAD;AADjB,eADwB,CALpC;;AAAA;AAAA;AAKeC,cAAAA,IALf,yBAKeA,IALf;AAKqBtB,cAAAA,KALrB,yBAKqBA,KALrB;;AAAA,oBAUYsB,IAAI,KAAK,SAVrB;AAAA;AAAA;AAAA;;AAWY,mBAAKtB,KAAL,GAAWA,KAAX;AACMuB,cAAAA,IAZlB,GAYyB;AAACvB,gBAAAA,KAAK,EAAEA,KAAR;AAAeI,gBAAAA,QAAQ,EAAE;AAAzB,eAZzB;AAakBoB,cAAAA,cAblB,GAamC;AACnBC,gBAAAA,MAAM,EAAE,MADW;AAEnBC,gBAAAA,OAAO,EAAE;AAAE,kCAAgB,kBAAlB;AAAqC,iDAA8B;AAAnE,iBAFU;AAGnBH,gBAAAA,IAAI,EAAEZ,IAAI,CAACC,SAAL,CAAeW,IAAf;AAHa,eAbnC;AAAA;AAAA,+CAkBmCI,KAAK,CAAChC,SAAS,CAACiC,QAAV,GAAqBjC,SAAS,CAACkC,oBAA/B,GAAsD,MAAvD,EAA8DL,cAA9D,CAlBxC;;AAAA;AAkBkBM,cAAAA,QAlBlB;;AAmBgB,kBAAGA,QAAQ,CAACC,EAAZ,EAAe;AACXD,gBAAAA,QAAQ,CAACE,IAAT,GAAgBC,IAAhB,CAAqB,UAACD,IAAD,EAAQ;AACzB,sBAAIE,MAAM,GAACF,IAAI,CAACG,KAAL,CAAW,aAAX,CAAX;AACA,sBAAIC,gBAAgB,GAACF,MAAM,CAAC,CAAD,CAAN,CAAUG,MAAV,CAAiB,CAAjB,CAArB;AACA,sBAAI7B,UAAU,GAAGG,IAAI,CAACK,KAAL,CAAWoB,gBAAX,CAAjB;AACA,sBAAI3B,WAAW,GAAGE,IAAI,CAACK,KAAL,CAAWkB,MAAM,CAAC,CAAD,CAAjB,CAAlB;;AACA,kBAAA,MAAI,CAACnB,QAAL,CAAc;AAACb,oBAAAA,IAAI,EAAC;AAACM,sBAAAA,UAAU,EAACA,UAAZ;AAAuBC,sBAAAA,WAAW,EAACA;AAAnC;AAAN,mBAAd;;AACA,kBAAA,MAAI,CAAC6B,SAAL,CAAe9B,UAAf,EAA0BC,WAA1B;AACH,iBAPD;AAQH,eATD,MASK;AACD,qBAAKM,QAAL,CAAc;AAACZ,kBAAAA,UAAU,EAAC;AAAZ,iBAAd;AACAoC,gBAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCV,QAArC;AACH;;AA/BjB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAiCcW,cAAAA,OAjCd,gBAiCcA,OAjCd;AAkCQF,cAAAA,OAAO,CAACC,GAAR,CAAY,0BAAwBC,OAApC;;AAlCR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WAsCA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACUrC,cAAAA,QADV,GACqB,KAAKH,KAAL,CAAWG,QADhC;;AAAA,oBAEO,IAAIsC,MAAJ,CAAW,sBAAX,EAAmCC,IAAnC,CAAwCvC,QAAxC,KAAqDA,QAAQ,KAAKwC,SAAlE,IAA+ExC,QAAQ,KAAK,IAFnG;AAAA;AAAA;AAAA;;AAGcmB,cAAAA,IAHd,GAGqB;AAACvB,gBAAAA,KAAK,EAAE,KAAKA,KAAb;AAAoBI,gBAAAA,QAAQ,EAAEA;AAA9B,eAHrB;AAIcoB,cAAAA,cAJd,GAI+B;AACnBC,gBAAAA,MAAM,EAAE,MADW;AAEnBC,gBAAAA,OAAO,EAAE;AAAE,kCAAgB,kBAAlB;AAAqC,iDAA8B;AAAnE,iBAFU;AAGnBH,gBAAAA,IAAI,EAAEZ,IAAI,CAACC,SAAL,CAAeW,IAAf;AAHa,eAJ/B;AAAA;AAAA,+CAS6BI,KAAK,CAAChC,SAAS,CAACiC,QAAV,GAAqBjC,SAAS,CAACkC,oBAA/B,GAAsD,SAAvD,EAAiEL,cAAjE,CATlC;;AAAA;AAScM,cAAAA,QATd;;AAUY,kBAAGA,QAAQ,CAACC,EAAZ,EAAe;AACXD,gBAAAA,QAAQ,CAACE,IAAT,GAAgBC,IAAhB,CAAqB,UAACD,IAAD,EAAQ;AACzB,sBAAIE,MAAM,GAACF,IAAI,CAACG,KAAL,CAAW,aAAX,CAAX;AACA,sBAAIC,gBAAgB,GAACF,MAAM,CAAC,CAAD,CAAN,CAAUG,MAAV,CAAiB,CAAjB,CAArB;AACA,sBAAI7B,UAAU,GAAGG,IAAI,CAACK,KAAL,CAAWoB,gBAAX,CAAjB;AACA,sBAAI3B,WAAW,GAAGE,IAAI,CAACK,KAAL,CAAWkB,MAAM,CAAC,CAAD,CAAjB,CAAlB;;AACA,kBAAA,MAAI,CAACnB,QAAL,CAAc;AAACb,oBAAAA,IAAI,EAAC;AAACM,sBAAAA,UAAU,EAACA,UAAZ;AAAuBC,sBAAAA,WAAW,EAACA;AAAnC;AAAN,mBAAd;;AACA,kBAAA,MAAI,CAAC6B,SAAL,CAAe9B,UAAf,EAA0BC,WAA1B;AACH,iBAPD;AAQH,eATD,MASK;AACD,qBAAKM,QAAL,CAAc;AAACZ,kBAAAA,UAAU,EAAC;AAAZ,iBAAd;AACH;;AArBb;AAAA;;AAAA;AAuBQ,mBAAKY,QAAL,CAAc;AAACZ,gBAAAA,UAAU,EAAC;AAAZ,eAAd;;AAvBR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WA0BA,kBAAS;AAAA;;AACL,aACI,MAAC,IAAD;AAAM,QAAA,KAAK,EAAET,iBAAiB,CAACmD,aAA/B;AAAA,mBACI,KAAC,IAAD;AAAM,UAAA,KAAK,EAAEnD,iBAAiB,CAACoD,QAA/B;AAAA;AAAA,UADJ,EAEI,KAAC,IAAD;AAAM,UAAA,KAAK,EAAE,CAACC,KAAK,CAACC,gBAAP,EAAwBtD,iBAAiB,CAACuD,SAA1C,CAAb;AAAA,oBACI,MAAC,IAAD;AAAM,YAAA,KAAK,EAAEF,KAAK,CAACG,UAAnB;AAAA,uBACI,MAAC,IAAD;AAAM,cAAA,KAAK,EAAEH,KAAK,CAACI,eAAnB;AAAA,yBACI,KAAC,IAAD;AAAM,gBAAA,IAAI,EAAC,aAAX;AAAyB,gBAAA,IAAI,EAAE;AAA/B,gBADJ,EAEI,KAAC,IAAD;AAAM,gBAAA,KAAK,EAAE,CAACJ,KAAK,CAACK,YAAP,EAAoB1D,iBAAiB,CAAC2D,WAAtC,CAAb;AAAA,0BAAmE,KAAKpD,KAAL,CAAWC,IAAX,IAAiB,IAAlB,GAA0B,KAAKD,KAAL,CAAWC,IAAX,CAAgBM,UAAhB,CAA2BJ,QAArD,GAAgE;AAAlI,gBAFJ;AAAA,cADJ,EAKI,MAAC,IAAD;AAAM,cAAA,KAAK,EAAE2C,KAAK,CAACO,UAAnB;AAAA,yBACI,MAAC,IAAD;AAAM,gBAAA,KAAK,EAAE,CAAC5D,iBAAiB,CAAC6D,UAAnB,EAA8BR,KAAK,CAACS,WAApC,CAAb;AAAA,qCAAuE,KAAKvD,KAAL,CAAWC,IAAX,IAAiB,IAAlB,GAA0B,KAAKD,KAAL,CAAWC,IAAX,CAAgBM,UAAhB,CAA2BiD,SAArD,GAAiE,WAAvI;AAAA,gBADJ,EAEI,MAAC,IAAD;AAAM,gBAAA,KAAK,EAAE,CAAC/D,iBAAiB,CAAC6D,UAAnB,EAA8BR,KAAK,CAACS,WAApC,CAAb;AAAA,wCAA0E,KAAKvD,KAAL,CAAWC,IAAX,IAAiB,IAAlB,GAA0B,KAAKD,KAAL,CAAWC,IAAX,CAAgBM,UAAhB,CAA2BkD,QAArD,GAAgE,UAAzI;AAAA,gBAFJ,EAGI,MAAC,IAAD;AAAM,gBAAA,KAAK,EAAE,CAAChE,iBAAiB,CAAC6D,UAAnB,EAA8BR,KAAK,CAACS,WAApC,CAAb;AAAA,4CAA8E,KAAKvD,KAAL,CAAWC,IAAX,IAAiB,IAAlB,GAA0B,KAAKD,KAAL,CAAWC,IAAX,CAAgBM,UAAhB,CAA2BmD,QAArD,GAAgE,UAA7I;AAAA,gBAHJ,EAII,MAAC,IAAD;AAAM,gBAAA,KAAK,EAAE,CAACjE,iBAAiB,CAAC6D,UAAnB,EAA8BR,KAAK,CAACS,WAApC,CAAb;AAAA,sCAAwE,KAAKvD,KAAL,CAAWC,IAAX,IAAiB,IAAlB,GAA0B,KAAKD,KAAL,CAAWC,IAAX,CAAgBM,UAAhB,CAA2BoD,KAArD,GAA6D,OAApI;AAAA,gBAJJ,EAKI,KAAC,MAAD;AAAQ,gBAAA,OAAO,EAAE;AAAA,yBAAI,MAAI,CAACC,UAAL,EAAJ;AAAA,iBAAjB;AAAwC,gBAAA,KAAK,EAAEd,KAAK,CAACe,MAArD;AAA6D,gBAAA,KAAK,EAAC;AAAnE,gBALJ;AAAA,cALJ;AAAA;AADJ,UAFJ,EAiBK,KAAKC,kBAAL,EAjBL;AAAA,QADJ;AAqBH;;;WACD,8BAAoB;AAAA;;AAChB,UAAG,KAAK9D,KAAL,CAAWC,IAAX,IAAiB,IAApB,EAAyB;AACrB,YAAG,KAAKD,KAAL,CAAWE,UAAX,KAAwB,CAA3B,EAA6B;AACzB,iBAAO,KAAC,IAAD;AAAM,YAAA,KAAK,EAAE,CAAC4C,KAAK,CAACiB,YAAP,EAAoBtE,iBAAiB,CAACuD,SAAtC,CAAb;AAAA,sBACH,MAAC,IAAD;AAAA,yBACI,KAAC,IAAD;AAAM,gBAAA,KAAK,EAAEvD,iBAAiB,CAACoD,QAA/B;AAAA;AAAA,gBADJ,EAEI,KAAC,MAAD;AAAQ,gBAAA,KAAK,EAAC,oBAAd;AAAmC,gBAAA,OAAO,EAAE;AAAA,yBAAI,MAAI,CAACmB,aAAL,EAAJ;AAAA;AAA5C,gBAFJ;AAAA;AADG,YAAP;AAMH,SAPD,MAOK;AACD,iBAAO,KAAC,IAAD;AAAM,YAAA,KAAK,EAAE,CAAClB,KAAK,CAACiB,YAAP,EAAoBtE,iBAAiB,CAACuD,SAAtC,CAAb;AAAA,sBACH,MAAC,IAAD;AAAA,yBACI,KAAC,IAAD;AAAM,gBAAA,KAAK,EAAEvD,iBAAiB,CAACoD,QAA/B;AAAA;AAAA,gBADJ,EAEI,KAAC,SAAD;AAAW,gBAAA,KAAK,EAAEC,KAAK,CAACmB,SAAxB;AAAmC,gBAAA,QAAQ,EAAE,kBAAAlC,IAAI;AAAA,yBAAE,MAAI,CAACjB,QAAL,CAAc;AAACX,oBAAAA,QAAQ,EAAC4B;AAAV,mBAAd,CAAF;AAAA;AAAjD,gBAFJ,EAGI,KAAC,MAAD;AAAQ,gBAAA,KAAK,EAAC,gBAAd;AAA+B,gBAAA,OAAO,EAAE;AAAA,yBAAI,MAAI,CAACmC,aAAL,EAAJ;AAAA;AAAxC,gBAHJ;AAAA;AADG,YAAP;AAOH;AAEJ;AACJ;;;;EAxImC5E,KAAK,CAAC6E,S;;SAAzBtE,U;AA2IrB,IAAMiD,KAAK,GAACsB,UAAU,CAACC,MAAX,CAAkB;AAC1BtB,EAAAA,gBAAgB,EAAC;AACbuB,IAAAA,OAAO,EAAC,MADK;AAEbC,IAAAA,aAAa,EAAC,KAFD;AAGbC,IAAAA,KAAK,EAAC,MAHO;AAIbC,IAAAA,SAAS,EAAC,IAJG;AAKbC,IAAAA,MAAM,EAAC;AALM,GADS;AAQ1BX,EAAAA,YAAY,EAAC;AACTS,IAAAA,KAAK,EAAC,MADG;AAETC,IAAAA,SAAS,EAAC,KAFD;AAGTC,IAAAA,MAAM,EAAC,MAHE;AAITC,IAAAA,QAAQ,EAAC,UAJA;AAKTC,IAAAA,eAAe,EAAC,OALP;AAMTN,IAAAA,OAAO,EAAC,MANC;AAOTO,IAAAA,UAAU,EAAC,QAPF;AAQTC,IAAAA,cAAc,EAAC,QARN;AASTC,IAAAA,OAAO,EAAC;AATC,GARa;AAmB1Bd,EAAAA,SAAS,EAAC;AACNe,IAAAA,YAAY,EAAC,CADP;AAENC,IAAAA,WAAW,EAAC,CAFN;AAGNC,IAAAA,WAAW,EAAC,OAHN;AAINT,IAAAA,SAAS,EAAC,IAJJ;AAKNU,IAAAA,YAAY,EAAC;AALP,GAnBgB;AA0B1BlC,EAAAA,UAAU,EAAC;AACPqB,IAAAA,OAAO,EAAC,MADD;AAEPC,IAAAA,aAAa,EAAC,QAFP;AAGPC,IAAAA,KAAK,EAAC;AAHC,GA1Be;AA+B1BY,EAAAA,WAAW,EAAC;AACRd,IAAAA,OAAO,EAAC,MADA;AAERC,IAAAA,aAAa,EAAC,QAFN;AAGRC,IAAAA,KAAK,EAAC;AAHE,GA/Bc;AAoC1BtB,EAAAA,eAAe,EAAC;AACZoB,IAAAA,OAAO,EAAC,MADI;AAEZC,IAAAA,aAAa,EAAC,KAFF;AAGZC,IAAAA,KAAK,EAAC,MAHM;AAIZa,IAAAA,WAAW,EAAC,KAJA;AAKZC,IAAAA,UAAU,EAAC,KALC;AAMZC,IAAAA,iBAAiB,EAAC;AANN,GApCU;AA4C1BlC,EAAAA,UAAU,EAAC;AACPiB,IAAAA,OAAO,EAAC,MADD;AAEPC,IAAAA,aAAa,EAAC,QAFP;AAGPC,IAAAA,KAAK,EAAC;AAHC,GA5Ce;AAiD1BrB,EAAAA,YAAY,EAAC;AACTkC,IAAAA,WAAW,EAAC,KADH;AAETX,IAAAA,MAAM,EAAC,MAFE;AAGTc,IAAAA,UAAU,EAAC,GAHF;AAITF,IAAAA,UAAU,EAAC,IAJF;AAKTG,IAAAA,SAAS,EAAC;AALD,GAjDa;AAwD1BlC,EAAAA,WAAW,EAAC;AACR8B,IAAAA,WAAW,EAAC,KADJ;AAERK,IAAAA,aAAa,EAAC,IAFN;AAGRJ,IAAAA,UAAU,EAAC,IAHH;AAIRC,IAAAA,iBAAiB,EAAC,CAJV;AAKRI,IAAAA,QAAQ,EAAC;AALD,GAxDc;AA+D1BC,EAAAA,YAAY,EAAC;AACTH,IAAAA,SAAS,EAAC,QADD;AAEThB,IAAAA,SAAS,EAAC,IAFD;AAGToB,IAAAA,IAAI,EAAC;AAHI,GA/Da;AAoE1BC,EAAAA,YAAY,EAAC;AACTxB,IAAAA,OAAO,EAAC,MADC;AAETuB,IAAAA,IAAI,EAAC,GAFI;AAGTrB,IAAAA,KAAK,EAAC,MAHG;AAITC,IAAAA,SAAS,EAAC;AAJD,GApEa;AA0E1BZ,EAAAA,MAAM,EAAC;AACHe,IAAAA,eAAe,EAAC,OADb;AAEHmB,IAAAA,KAAK,EAAC,OAFH;AAGHd,IAAAA,WAAW,EAAC,CAHT;AAIHC,IAAAA,WAAW,EAAC,OAJT;AAKHF,IAAAA,YAAY,EAAC;AALV;AA1EmB,CAAlB,CAAZ","sourcesContent":["import React, {useEffect} from 'react';\r\nimport Icon from 'react-native-vector-icons/FontAwesome';\r\nimport {StyleSheet, Text, View, Button, TouchableOpacity, TextInput} from 'react-native';\r\nimport generalStyleSheet from \"../general/GeneralStyleSheet\";\r\nimport Constants from \"../constants\";\r\nimport * as Facebook from 'expo-facebook';\r\nimport { AsyncStorage } from 'react-native';\r\n\r\n\r\nexport default class ProfileTab extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={user:null,loginPhase:0,username:\"\"}\r\n        this.props.navigation.addListener('focus',()=>{\r\n            this.loadUser();\r\n        });\r\n    }\r\n\r\n    token=null;\r\n\r\n    async storeUser(userObject,tokenObject){\r\n        await AsyncStorage.setItem(\"user\",JSON.stringify({userObject:userObject,tokenObject:tokenObject}));\r\n    }\r\n\r\n    async loadUser(){\r\n        const value = await AsyncStorage.getItem(\"user\");\r\n        if(value!=null)\r\n            this.setState({user:JSON.parse(value)})\r\n        else\r\n            this.setState({user:null})\r\n    }\r\n\r\n    async removeUser(){\r\n        await  AsyncStorage.removeItem(\"user\");\r\n        this.setState({user:null});\r\n    }\r\n\r\n    async facebookLogin() {\r\n        try {\r\n            await Facebook.initializeAsync({\r\n                appId: '451106016421871',\r\n            });\r\n            const {type, token} = await Facebook.logInWithReadPermissionsAsync(\r\n                {\r\n                    permissions: [\"public_profile\"]\r\n                },\r\n            );\r\n            if (type === 'success') {\r\n                this.token=token;\r\n                const body = {token: token, username: \"\"}\r\n                const requestOptions = {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json','Access-Control-Allow-Origin':'*' },\r\n                    body: JSON.stringify(body)\r\n                };\r\n                const response = await fetch(Constants.serverIp + Constants.userMicroserviceName + \"user\",requestOptions)\r\n                    if(response.ok){\r\n                        response.text().then((text)=>{\r\n                            let fields=text.split(\"AccessToken\");\r\n                            let userObjectString=fields[0].substr(6)\r\n                            let userObject = JSON.parse(userObjectString);\r\n                            let tokenObject = JSON.parse(fields[1])\r\n                            this.setState({user:{userObject:userObject,tokenObject:tokenObject}});\r\n                            this.storeUser(userObject,tokenObject);\r\n                        })\r\n                    }else{\r\n                        this.setState({loginPhase:1});\r\n                        console.log(\"nessun utente trovato\", response)\r\n                    }\r\n            }\r\n        } catch ({message}) {\r\n            console.log(`Facebook Login Error `+message);\r\n        }\r\n    }\r\n\r\n    async completeLogin() {\r\n        const username = this.state.username\r\n        if(new RegExp('^[a-zA-Z0-9._-]{3,}$').test(username) && username !== undefined && username !== null){ //Test username if is correct\r\n            const body = {token: this.token, username: username}\r\n            const requestOptions = {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json','Access-Control-Allow-Origin':'*'  },\r\n                body: JSON.stringify(body)\r\n            };\r\n            const response=await fetch(Constants.serverIp + Constants.userMicroserviceName + \"loginFB\",requestOptions)\r\n                if(response.ok){\r\n                    response.text().then((text)=>{\r\n                        let fields=text.split(\"AccessToken\");\r\n                        let userObjectString=fields[0].substr(6)\r\n                        let userObject = JSON.parse(userObjectString);\r\n                        let tokenObject = JSON.parse(fields[1])\r\n                        this.setState({user:{userObject:userObject,tokenObject:tokenObject}});\r\n                        this.storeUser(userObject,tokenObject);\r\n                    })\r\n                }else{\r\n                    this.setState({loginPhase:0});\r\n                }\r\n        }else\r\n            this.setState({loginPhase:0});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <View style={generalStyleSheet.viewContainer}>\r\n                <Text style={generalStyleSheet.bigTitle}>Profilo</Text>\r\n                <View style={[style.profileContainer,generalStyleSheet.bigBorder]}>\r\n                    <View style={style.leftColumn}>\r\n                        <View style={style.firstProfileRow}>\r\n                            <Icon name=\"user-circle\" size={100}/>\r\n                            <Text style={[style.usernameText,generalStyleSheet.mediumTitle]}>{(this.state.user!=null) ? this.state.user.userObject.username : \"Username\"}</Text>\r\n                        </View>\r\n                        <View style={style.profileRow}>\r\n                            <Text style={[generalStyleSheet.normalText,style.profileText]}>Nome: {(this.state.user!=null) ? this.state.user.userObject.firstName : \"FirstName\"}</Text>\r\n                            <Text style={[generalStyleSheet.normalText,style.profileText]}>Cognome: {(this.state.user!=null) ? this.state.user.userObject.lastName : \"LastName\"}</Text>\r\n                            <Text style={[generalStyleSheet.normalText,style.profileText]}>DataNascita: {(this.state.user!=null) ? this.state.user.userObject.birthday : \"Birthday\"}</Text>\r\n                            <Text style={[generalStyleSheet.normalText,style.profileText]}>Email: {(this.state.user!=null) ? this.state.user.userObject.email : \"Email\"}</Text>\r\n                            <Button onPress={()=>this.removeUser()} style={style.logOut} title=\"LogOut\"/>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n                {this.renderBlockingView()}\r\n            </View>\r\n        );\r\n    }\r\n    renderBlockingView(){\r\n        if(this.state.user==null){\r\n            if(this.state.loginPhase===0){\r\n                return <View style={[style.notLoggedTab,generalStyleSheet.bigBorder]}>\r\n                    <View>\r\n                        <Text style={generalStyleSheet.bigTitle}>Sembrerebbe che tu non sia loggato</Text>\r\n                        <Button title=\"Login con Facebook\" onPress={()=>this.facebookLogin()}/>\r\n                    </View>\r\n                </View>\r\n            }else{\r\n                return <View style={[style.notLoggedTab,generalStyleSheet.bigBorder]}>\r\n                    <View>\r\n                        <Text style={generalStyleSheet.bigTitle}>Inserisci il tuo username</Text>\r\n                        <TextInput style={style.textInput} onChange={text=>this.setState({username:text})}/>\r\n                        <Button title=\"Completa login\" onPress={()=>this.completeLogin()}/>\r\n                    </View>\r\n                </View>\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n}\r\nconst style=StyleSheet.create({\r\n    profileContainer:{\r\n        display:\"flex\",\r\n        flexDirection:\"row\",\r\n        width:\"100%\",\r\n        marginTop:\"3%\",\r\n        height:\"75%\",\r\n    },\r\n    notLoggedTab:{\r\n        width:\"100%\",\r\n        marginTop:\"-1%\",\r\n        height:\"115%\",\r\n        position:\"absolute\",\r\n        backgroundColor:\"white\",\r\n        display:\"flex\",\r\n        alignItems:\"center\",\r\n        justifyContent:\"center\",\r\n        padding:\"2%\"\r\n    },\r\n    textInput:{\r\n        borderRadius:5,\r\n        borderWidth:1,\r\n        borderColor:\"black\",\r\n        marginTop:\"4%\",\r\n        marginBottom:\"4%\"\r\n    },\r\n    leftColumn:{\r\n        display:\"flex\",\r\n        flexDirection:\"column\",\r\n        width:\"100%\",\r\n    },\r\n    rightColumn:{\r\n        display:\"flex\",\r\n        flexDirection:\"column\",\r\n        width:\"75%\"\r\n    },\r\n    firstProfileRow:{\r\n        display:\"flex\",\r\n        flexDirection:\"row\",\r\n        width:\"100%\",\r\n        paddingLeft:\"10%\",\r\n        paddingTop:\"10%\",\r\n        borderBottomWidth:1,\r\n    },\r\n    profileRow:{\r\n        display:\"flex\",\r\n        flexDirection:\"column\",\r\n        width:\"100%\",\r\n    },\r\n    usernameText:{\r\n        paddingLeft:\"12%\",\r\n        height:\"100%\",\r\n        lineHeight:100,\r\n        paddingTop:\"4%\",\r\n        textAlign:\"center\"\r\n    },\r\n    profileText:{\r\n        paddingLeft:\"10%\",\r\n        paddingBottom:\"5%\",\r\n        paddingTop:\"5%\",\r\n        borderBottomWidth:1,\r\n        fontSize:15,\r\n    },\r\n    productTitle:{\r\n        textAlign:\"center\",\r\n        marginTop:\"6%\",\r\n        flex:0.1\r\n    },\r\n    productsView:{\r\n        display:\"flex\",\r\n        flex:0.9,\r\n        width:\"100%\",\r\n        marginTop:\"2%\"\r\n    },\r\n    logOut:{\r\n        backgroundColor:\"white\",\r\n        color:\"black\",\r\n        borderWidth:2,\r\n        borderColor:\"black\",\r\n        borderRadius:5\r\n    }\r\n})\r\n"]},"metadata":{},"sourceType":"module"}